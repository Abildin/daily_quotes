// Generated by CoffeeScript 1.9.1
var app, formatDate;

formatDate = function(date) {
  var result;
  result = (date.getFullYear()) + "-";
  if ((date.getMonth() + 1).toString().length < 2) {
    result += "0";
  }
  result += (date.getMonth() + 1) + "-";
  if (date.getDate().toString().length < 2) {
    result += "0";
  }
  result += date.getDate();
  return result;
};

app = angular.module('mainApp', []);

app.config(function($interpolateProvider) {
  $interpolateProvider.startSymbol('{[{');
  return $interpolateProvider.endSymbol('}]}');
});

app.controller('MainCtrl', function($http, $timeout) {
  var $this;
  return $this = {
    selected: null,
    quotes: [],
    getQuotes: function() {
      return $http({
        method: "GET",
        url: $this.hostname + "/api/v1/quote/"
      }).success(function(result) {
        $this.meta = result.meta;
        $this.quotes = result.objects;
        return console.log($this.quotes);
      }).error(function(error) {
        return console.error(error);
      });
    },
    init: function(url) {
      $this.hostname = url;
      return $this.getQuotes();
    },
    select: function(quote) {
      return $this.selected = quote;
    },
    cancel: function() {
      return $this.selected = null;
    },
    add: function() {
      return $this.selected = {
        date: formatDate(new Date())
      };
    },
    save: function() {
      var method, url;
      method = "";
      url = $this.hostname;
      if ($this.selected.resource_uri) {
        url += $this.selected.resource_uri;
        method = "PATCH";
      } else {
        url += "/api/v1/quote/";
        method = "POST";
      }
      return $http({
        method: method,
        url: url,
        data: {
          date: $this.selected.date,
          quote: $this.selected.quote,
          source: $this.selected.source
        }
      }).success(function(result) {
        console.log(result);
        if (!$this.selected.resource_uri) {
          $this.selected = null;
        }
        return $this.getQuotes();
      }).error(function(error) {
        return console.error(error);
      });
    },
    "delete": function() {
      console.log($this.hostname + $this.selected.resource_uri);
      return $http({
        method: "DELETE",
        url: $this.hostname + $this.selected.resource_uri
      }).success(function(result) {
        console.log(result);
        $this.selected = null;
        return $this.getQuotes();
      }).error(function(error) {
        return console.error(error);
      });
    }
  };
});
